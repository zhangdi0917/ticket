package com.jess.ticket.ui.activity;import com.jess.ticket.R;import com.jess.ticket.ui.fragment.BaseFragment;import com.jess.ticket.ui.fragment.MyTicketFragment;import com.jess.ticket.ui.fragment.NearbyFragment;import com.jess.ticket.ui.fragment.SettingFragment;import com.jess.ticket.ui.fragment.ShareFragment;import android.os.Bundle;import android.app.Activity;import android.app.FragmentManager;import android.app.FragmentTransaction;import android.content.res.Configuration;import android.support.v4.app.ActionBarDrawerToggle;import android.support.v4.view.GravityCompat;import android.support.v4.widget.DrawerLayout;import android.view.Menu;import android.view.MenuItem;import android.view.View;public class MainActivity extends Activity {    private DrawerLayout mDrawerLayout;    private CustomActionBarDrawerToggle mDrawerToggle;    private View mNearbyView;    private View mMyTicketView;    private View mShareView;    private View mSettingView;    private static final String BUNDLE_CURRENT_FRAGMENT_ID = "BUNDLE_CURRENT_FRAGMENT_ID_id";    private int mCurrentFragmentId;    private BaseFragment mCurrentFragment;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        setContentView(R.layout.activity_main);        getActionBar().setDisplayHomeAsUpEnabled(true);        getActionBar().setHomeButtonEnabled(true);        getActionBar().setDisplayShowHomeEnabled(false);        mDrawerLayout = (DrawerLayout) findViewById(R.id.drawer_layout);        mDrawerLayout.setDrawerShadow(R.drawable.drawer_shadow, GravityCompat.START);        mDrawerToggle = new CustomActionBarDrawerToggle(this, mDrawerLayout);        mDrawerLayout.setDrawerListener(mDrawerToggle);        initMenu();        if (savedInstanceState == null) {            mCurrentFragmentId = R.id.menu_nearby_tv;        } else {            mCurrentFragmentId = savedInstanceState.getInt(BUNDLE_CURRENT_FRAGMENT_ID);        }        switchFragment(mCurrentFragmentId);    }    private void initMenu() {        mNearbyView = findViewById(R.id.menu_nearby_tv);        mMyTicketView = findViewById(R.id.menu_my_ticket_tv);        mShareView = findViewById(R.id.menu_share_tv);        mSettingView = findViewById(R.id.menu_setting_tv);        mNearbyView.setOnClickListener(mOnMenuClickListener);        mMyTicketView.setOnClickListener(mOnMenuClickListener);        mShareView.setOnClickListener(mOnMenuClickListener);        mSettingView.setOnClickListener(mOnMenuClickListener);    }    private View.OnClickListener mOnMenuClickListener = new View.OnClickListener() {        @Override        public void onClick(View v) {            mCurrentFragmentId = v.getId();            switchFragment(mCurrentFragmentId);            mDrawerLayout.closeDrawers();        }    };    @Override    protected void onSaveInstanceState(Bundle outState) {        super.onSaveInstanceState(outState);        outState.putInt(BUNDLE_CURRENT_FRAGMENT_ID, mCurrentFragmentId);    }    @Override    protected void onPostCreate(Bundle savedInstanceState) {        super.onPostCreate(savedInstanceState);        mDrawerToggle.syncState();    }    @Override    public void onConfigurationChanged(Configuration newConfig) {        super.onConfigurationChanged(newConfig);        mDrawerToggle.onConfigurationChanged(newConfig);    }    @Override    public boolean onCreateOptionsMenu(Menu menu) {        getMenuInflater().inflate(R.menu.main, menu);        return true;    }    @Override    public boolean onOptionsItemSelected(MenuItem item) {        if (mDrawerToggle.onOptionsItemSelected(item)) {            return true;        }        return super.onOptionsItemSelected(item);    }    private class CustomActionBarDrawerToggle extends ActionBarDrawerToggle {        public CustomActionBarDrawerToggle(Activity mActivity, DrawerLayout mDrawerLayout) {            super(mActivity, mDrawerLayout, R.drawable.ic_drawer, R.string.app_name, R.string.app_name);        }        @Override        public void onDrawerClosed(View view) {            getActionBar().setTitle(mCurrentFragment.getTitleResourceId());            invalidateOptionsMenu(); // creates call to onPrepareOptionsMenu()        }        @Override        public void onDrawerOpened(View drawerView) {            getActionBar().setTitle(getString(R.string.app_name));            invalidateOptionsMenu(); // creates call to onPrepareOptionsMenu()        }    }    private void switchFragment(int id) {        FragmentManager fragmentManager = getFragmentManager();        FragmentTransaction fragmentTransaction = fragmentManager.beginTransaction();        mCurrentFragment = (BaseFragment) fragmentManager.findFragmentById(id);        if (mCurrentFragment == null) {            switch (id) {            case R.id.menu_nearby_tv:                mCurrentFragment = new NearbyFragment();                break;            case R.id.menu_my_ticket_tv:                mCurrentFragment = new MyTicketFragment();                break;            case R.id.menu_share_tv:                mCurrentFragment = new ShareFragment();                break;            case R.id.menu_setting_tv:                mCurrentFragment = new SettingFragment();                break;            }        }        fragmentTransaction.replace(R.id.fragment_main, mCurrentFragment);        fragmentTransaction.commit();    }}